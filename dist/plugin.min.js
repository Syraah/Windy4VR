const t={name:"windy-plugin-windy4vr",version:"1.0.6",title:"Windy4VR",icon:"ðŸ¥•",description:"Plugin windy pour visualiser son routage virtuel",author:"Syraah",repository:"https://github.com/Syraah/Windy4VR",desktopUI:"rhpane",mobileUI:"small",desktopWidth:400,routerPath:"/windy4vr",built:1735943716332,builtReadable:"2025-01-03T22:35:16.332Z"},{map:e}=W.map,n=W.store,{wind2obj:l}=W.utils,{getLatLonInterpolator:o}=W.interpolator,a=W.metrics,r=W.broadcast;function s(){}function i(t){return t()}function c(){return Object.create(null)}function u(t){t.forEach(i)}function d(t){return"function"==typeof t}function g(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function f(t,e){t.appendChild(e)}function p(t,e,n){const l=function(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;if(e&&e.host)return e;return t.ownerDocument}(t);if(!l.getElementById(e)){const t=b("style");t.id=e,t.textContent=n,function(t,e){f(t.head||t,e),e.sheet}(l,t)}}function h(t,e,n){t.insertBefore(e,n||null)}function m(t){t.parentNode&&t.parentNode.removeChild(t)}function v(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function b(t){return document.createElement(t)}function x(t){return document.createTextNode(t)}function w(){return x(" ")}function y(t,e,n,l){return t.addEventListener(e,n,l),()=>t.removeEventListener(e,n,l)}function C(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function $(t,e){e=""+e,t.data!==e&&(t.data=e)}function S(t,e,n,l){null==n?t.style.removeProperty(e):t.style.setProperty(e,n,"")}let A;function j(t){A=t}function T(){if(!A)throw new Error("Function called outside component initialization");return A}const F=[],k=[];let O=[];const G=[],_=Promise.resolve();let E=!1;function D(t){O.push(t)}const N=new Set;let M=0;function I(){if(0!==M)return;const t=A;do{try{for(;M<F.length;){const t=F[M];M++,j(t),P(t.$$)}}catch(t){throw F.length=0,M=0,t}for(j(null),F.length=0,M=0;k.length;)k.pop()();for(let t=0;t<O.length;t+=1){const e=O[t];N.has(e)||(N.add(e),e())}O.length=0}while(F.length);for(;G.length;)G.pop()();E=!1,N.clear(),j(t)}function P(t){if(null!==t.fragment){t.update(),u(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(D)}}const R=new Set;function q(t){return void 0!==t?.length?t:Array.from(t)}function Z(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];O.forEach((l=>-1===t.indexOf(l)?e.push(l):n.push(l))),n.forEach((t=>t())),O=e}(n.after_update),u(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function H(t,e){-1===t.$$.dirty[0]&&(F.push(t),E||(E=!0,_.then(I)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function z(t,e,n,l,o,a,r=null,g=[-1]){const f=A;j(t);const p=t.$$={fragment:null,ctx:[],props:a,update:s,not_equal:o,bound:c(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(f?f.$$.context:[])),callbacks:c(),dirty:g,skip_bound:!1,root:e.target||f.$$.root};r&&r(p.root);let h=!1;if(p.ctx=n?n(t,e.props||{},((e,n,...l)=>{const a=l.length?l[0]:n;return p.ctx&&o(p.ctx[e],p.ctx[e]=a)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](a),h&&H(t,e)),n})):[],p.update(),h=!0,u(p.before_update),p.fragment=!!l&&l(p.ctx),e.target){if(e.hydrate){const t=function(t){return Array.from(t.childNodes)}(e.target);p.fragment&&p.fragment.l(t),t.forEach(m)}else p.fragment&&p.fragment.c();e.intro&&((v=t.$$.fragment)&&v.i&&(R.delete(v),v.i(b))),function(t,e,n){const{fragment:l,after_update:o}=t.$$;l&&l.m(e,n),D((()=>{const e=t.$$.on_mount.map(i).filter(d);t.$$.on_destroy?t.$$.on_destroy.push(...e):u(e),t.$$.on_mount=[]})),o.forEach(D)}(t,e.target,e.anchor),I()}var v,b;j(f)}class U{$$=void 0;$$set=void 0;$destroy(){Z(this,1),this.$destroy=s}$on(t,e){if(!d(e))return s;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function B(t){p(t,"svelte-jhfxbu",".ZE.svelte-jhfxbu.svelte-jhfxbu{margin-top:20px}.reset-button.svelte-jhfxbu.svelte-jhfxbu{margin-top:10px;padding:5px 10px;background-color:#fff;color:black;border:none;cursor:pointer;border-radius:4px}.reset-button.svelte-jhfxbu.svelte-jhfxbu:hover{background-color:#e63939}table.svelte-jhfxbu.svelte-jhfxbu{width:100%;border-collapse:collapse;margin-top:20px}th.svelte-jhfxbu.svelte-jhfxbu,td.svelte-jhfxbu.svelte-jhfxbu{border:1px solid #ddd;padding:8px}th.svelte-jhfxbu.svelte-jhfxbu{background-color:#f4f4f4;text-align:left;color:#4d4d4d}td.svelte-jhfxbu div.svelte-jhfxbu{display:inline-block;border:1px solid #000}")}function V(t,e,n){const l=t.slice();return l[39]=e[n],l[41]=n,l}function X(t,e,n){const l=t.slice();return l[42]=e[n],l[41]=n,l}function Y(t){let e,n,l,o,a;return{c(){e=b("p"),e.textContent="SÃ©lectionnez un(des) fichier(s) GPX pour afficher la trace sur la map.",n=w(),l=b("input"),C(l,"type","file"),C(l,"accept",".gpx,.csv"),l.multiple=!0},m(r,s){h(r,e,s),h(r,n,s),h(r,l,s),o||(a=y(l,"change",t[6]),o=!0)},p:s,d(t){t&&(m(e),m(n),m(l)),o=!1,a()}}}function J(t){let e,n,l,o,a,r,s=q(t[4]),i=[];for(let e=0;e<s.length;e+=1)i[e]=et(X(t,s,e));return{c(){e=b("h3"),e.textContent="Windy Data:",n=w(),l=b("table"),o=b("thead"),o.innerHTML='<tr><th class="svelte-jhfxbu">Route</th> <th class="svelte-jhfxbu">TWS</th> <th class="svelte-jhfxbu">TWD</th> <th class="svelte-jhfxbu">TWA</th></tr>',a=w(),r=b("tbody");for(let t=0;t<i.length;t+=1)i[t].c();C(l,"class","svelte-jhfxbu")},m(t,s){h(t,e,s),h(t,n,s),h(t,l,s),f(l,o),f(l,a),f(l,r);for(let t=0;t<i.length;t+=1)i[t]&&i[t].m(r,null)},p(t,e){if(53&e[0]){let n;for(s=q(t[4]),n=0;n<s.length;n+=1){const l=X(t,s,n);i[n]?i[n].p(l,e):(i[n]=et(l),i[n].c(),i[n].m(r,null))}for(;n<i.length;n+=1)i[n].d(1);i.length=s.length}},d(t){t&&(m(e),m(n),m(l)),v(i,t)}}}function K(t){let e,n=t[42].windSpeed+"";return{c(){e=x(n)},m(t,n){h(t,e,n)},p(t,l){16&l[0]&&n!==(n=t[42].windSpeed+"")&&$(e,n)},d(t){t&&m(e)}}}function Q(t){let e,n,l=t[42].windDir+"";return{c(){e=x(l),n=x("Â°")},m(t,l){h(t,e,l),h(t,n,l)},p(t,n){16&n[0]&&l!==(l=t[42].windDir+"")&&$(e,l)},d(t){t&&(m(e),m(n))}}}function tt(t){let e,n,l=t[42].TWA+"";return{c(){e=x(l),n=x("Â°")},m(t,l){h(t,e,l),h(t,n,l)},p(t,n){16&n[0]&&l!==(l=t[42].TWA+"")&&$(e,l)},d(t){t&&(m(e),m(n))}}}function et(t){let e,n,l,o,a,r,s,i,c,u,d,g=!t[2]&&K(t),p=!t[2]&&Q(t),v=!t[2]&&tt(t);return{c(){e=b("tr"),n=b("td"),l=b("div"),a=w(),r=b("td"),g&&g.c(),s=w(),i=b("td"),p&&p.c(),c=w(),u=b("td"),v&&v.c(),d=w(),S(l,"width","20px"),S(l,"height","20px"),S(l,"background-color",t[5][t[41]]),C(l,"title",o=t[0][t[41]].fileName),C(l,"class","svelte-jhfxbu"),C(n,"class","svelte-jhfxbu"),C(r,"class","svelte-jhfxbu"),C(i,"class","svelte-jhfxbu"),C(u,"class","svelte-jhfxbu")},m(t,o){h(t,e,o),f(e,n),f(n,l),f(e,a),f(e,r),g&&g.m(r,null),f(e,s),f(e,i),p&&p.m(i,null),f(e,c),f(e,u),v&&v.m(u,null),f(e,d)},p(t,e){32&e[0]&&S(l,"background-color",t[5][t[41]]),1&e[0]&&o!==(o=t[0][t[41]].fileName)&&C(l,"title",o),t[2]?g&&(g.d(1),g=null):g?g.p(t,e):(g=K(t),g.c(),g.m(r,null)),t[2]?p&&(p.d(1),p=null):p?p.p(t,e):(p=Q(t),p.c(),p.m(i,null)),t[2]?v&&(v.d(1),v=null):v?v.p(t,e):(v=tt(t),v.c(),v.m(u,null))},d(t){t&&m(e),g&&g.d(),p&&p.d(),v&&v.d()}}}function nt(t){let e,n,l,o,a,r,s,i,c,d,g,p,$,S,L,A=q(t[1]),j=[];for(let e=0;e<A.length;e+=1)j[e]=lt(V(t,A,e));return{c(){e=b("h3"),e.textContent="GPX Waypoint details",n=w(),l=b("table"),o=b("thead"),o.innerHTML='<tr><th class="svelte-jhfxbu">Route</th> <th class="svelte-jhfxbu">HDG</th> <th class="svelte-jhfxbu">Speed</th> <th class="svelte-jhfxbu">TWS</th> <th class="svelte-jhfxbu">TWA</th> <th class="svelte-jhfxbu">Sail</th></tr>',a=w(),r=b("tbody");for(let t=0;t<j.length;t+=1)j[t].c();s=w(),i=b("label"),c=b("input"),d=x(" Zones d'exclusion VG2024"),g=b("br"),p=w(),$=b("button"),$.textContent="RÃ©initialiser",C(l,"class","svelte-jhfxbu"),C(c,"class","ZE svelte-jhfxbu"),C(c,"type","checkbox"),C($,"class","reset-button svelte-jhfxbu")},m(u,m){h(u,e,m),h(u,n,m),h(u,l,m),f(l,o),f(l,a),f(l,r);for(let t=0;t<j.length;t+=1)j[t]&&j[t].m(r,null);h(u,s,m),h(u,i,m),f(i,c),f(i,d),f(i,g),h(u,p,m),h(u,$,m),S||(L=[y(c,"click",t[8]),y($,"click",t[7])],S=!0)},p(t,e){if(35&e[0]){let n;for(A=q(t[1]),n=0;n<A.length;n+=1){const l=V(t,A,n);j[n]?j[n].p(l,e):(j[n]=lt(l),j[n].c(),j[n].m(r,null))}for(;n<j.length;n+=1)j[n].d(1);j.length=A.length}},d(t){t&&(m(e),m(n),m(l),m(s),m(i),m(p),m($)),v(j,t),S=!1,u(L)}}}function lt(t){let e,n,l,o,a,r,s,i,c,u,d,g,p,v,y,L,A,j,W,T,F,k,O,G,_=(t[39].COG||"N/A")+"",E=(t[39].SOG||"N/A")+"",D=(t[39].TWS||"N/A")+"",N=(t[39].TWA||"N/A")+"",M=(t[39].SAIL||"N/A")+"";return{c(){e=b("tr"),n=b("td"),l=b("div"),a=w(),r=b("td"),s=x(_),i=x("Â°"),c=w(),u=b("td"),d=x(E),g=x(" nds"),p=w(),v=b("td"),y=x(D),L=x(" nds"),A=w(),j=b("td"),W=x(N),T=x("Â°"),F=w(),k=b("td"),O=x(M),G=w(),S(l,"width","20px"),S(l,"height","20px"),S(l,"background-color",t[5][t[41]]),C(l,"title",o=t[0][t[41]].fileName),C(l,"class","svelte-jhfxbu"),C(n,"class","svelte-jhfxbu"),C(r,"class","svelte-jhfxbu"),C(u,"class","svelte-jhfxbu"),C(v,"class","svelte-jhfxbu"),C(j,"class","svelte-jhfxbu"),C(k,"class","svelte-jhfxbu")},m(t,o){h(t,e,o),f(e,n),f(n,l),f(e,a),f(e,r),f(r,s),f(r,i),f(e,c),f(e,u),f(u,d),f(u,g),f(e,p),f(e,v),f(v,y),f(v,L),f(e,A),f(e,j),f(j,W),f(j,T),f(e,F),f(e,k),f(k,O),f(e,G)},p(t,e){32&e[0]&&S(l,"background-color",t[5][t[41]]),1&e[0]&&o!==(o=t[0][t[41]].fileName)&&C(l,"title",o),2&e[0]&&_!==(_=(t[39].COG||"N/A")+"")&&$(s,_),2&e[0]&&E!==(E=(t[39].SOG||"N/A")+"")&&$(d,E),2&e[0]&&D!==(D=(t[39].TWS||"N/A")+"")&&$(y,D),2&e[0]&&N!==(N=(t[39].TWA||"N/A")+"")&&$(W,N),2&e[0]&&M!==(M=(t[39].SAIL||"N/A")+"")&&$(O,M)},d(t){t&&m(e)}}}function ot(t){let e,n,l,o,a,r=!t[3]&&Y(t),i=t[0].length>0&&J(t),c=t[3]&&nt(t);return{c(){e=b("section"),n=b("div"),n.textContent="Windy4VR",l=w(),r&&r.c(),o=w(),i&&i.c(),a=w(),c&&c.c(),C(n,"class","plugin__title"),C(e,"class","plugin__content")},m(t,s){h(t,e,s),f(e,n),f(e,l),r&&r.m(e,null),f(e,o),i&&i.m(e,null),f(e,a),c&&c.m(e,null)},p(t,n){t[3]?r&&(r.d(1),r=null):r?r.p(t,n):(r=Y(t),r.c(),r.m(e,o)),t[0].length>0?i?i.p(t,n):(i=J(t),i.c(),i.m(e,a)):i&&(i.d(1),i=null),t[3]?c?c.p(t,n):(c=nt(t),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i:s,o:s,d(t){t&&m(e),r&&r.d(),i&&i.d(),c&&c.d()}}}function at(t){return new Promise(((e,n)=>{const l=new FileReader;l.onload=t=>e(t.target.result),l.onerror=t=>n(t),l.readAsText(t)}))}function rt(t,e){const[n,l]=t.split("/"),[o,a]=l.split(" ");return new Date(`${e}-${o}-${n}T${a}`)}function st(t,e){let n=(t-e+360)%360;return n>180&&(n-=360),Math.round(n)}function it(t,e,n,l){const o=t=>t*Math.PI/180,a=o(t),r=o(n),s=o(l-e),i=Math.sin(s)*Math.cos(r),c=Math.cos(a)*Math.sin(r)-Math.sin(a)*Math.cos(r)*Math.cos(s);let u=180*Math.atan2(i,c)/Math.PI;return Math.round((u+360)%360)}function ct(t,s,i){let c=[],u=[],d=[],g=[],f=!1;new Date(n.get("timestamp")).toLocaleString();let p=!1,h=[],m=[],v=null,b=[],x=[],w="",y=!1;const C='<svg  viewBox="0 0 14 14" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;"><path d="M4.784,13.635c0,0 -0.106,-2.924 0.006,-4.379c0.115,-1.502 0.318,-3.151 0.686,-4.632c0.163,-0.654 0.45,-1.623 0.755,-2.44c0.202,-0.54 0.407,-1.021 0.554,-1.352c0.038,-0.085 0.122,-0.139 0.215,-0.139c0.092,0 0.176,0.054 0.214,0.139c0.151,0.342 0.361,0.835 0.555,1.352c0.305,0.817 0.592,1.786 0.755,2.44c0.368,1.481 0.571,3.13 0.686,4.632c0.112,1.455 0.006,4.379 0.006,4.379l-4.432,0Z" style="fill:#000;"/><path d="M5.481,12.731c0,0 -0.073,-3.048 0.003,-4.22c0.06,-0.909 0.886,-3.522 1.293,-4.764c0.03,-0.098 0.121,-0.165 0.223,-0.165c0.103,0 0.193,0.067 0.224,0.164c0.406,1.243 1.232,3.856 1.292,4.765c0.076,1.172 0.003,4.22 0.003,4.22l-3.038,0Z" style="fill:#fff;fill-opacity:0.846008;"/></svg>',$='<svg xmlns="http://www.w3.org/2000/svg" viewBox="-23.6626 -11.6643 10.13 31.78" width="12px" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">\n\t<path d="M -13.6675 17.5876 C -13.5859 17.5005 -13.5395 17.386 -13.5377 17.2667 C -13.5377 17.2667 -13.5272 16.724 -13.5656 16.0588 C -13.6038 15.3939 -13.673 14.6183 -13.9117 14.0237 C -14.3916 12.828 -15.0129 12.1904 -16.2213 10.9823 L -16.3619 10.8417 C -16.0511 10.7066 -15.7589 10.5416 -15.5067 10.3259 C -14.886 9.7949 -14.4958 8.9926 -14.5561 8.0627 C -14.7854 4.5287 -15.0472 -0.203 -15.6672 -3.3076 C -16.1591 -5.7715 -17.1428 -10.6992 -17.1428 -10.6992 C -17.2542 -11.2578 -17.7505 -11.6645 -18.3201 -11.6643 H -18.5402 C -19.0775 -11.6642 -19.5537 -11.303 -19.6977 -10.7853 C -19.6977 -10.7853 -20.5206 -7.8271 -20.932 -6.3478 C -22.2827 -1.4909 -22.9811 3.2939 -22.9831 8.7733 C -22.9835 9.7617 -22.2964 10.4539 -21.5352 10.8124 C -21.2793 10.9325 -21.0113 11.0166 -20.7424 11.0855 L -20.9784 11.3215 C -22.1992 12.5423 -22.5107 13.0302 -22.9419 14.0089 C -23.2162 14.6316 -23.378 15.489 -23.4921 16.2218 S -23.6605 17.5543 -23.6605 17.5543 C -23.685 17.8183 -23.4908 18.0521 -23.2268 18.0765 C -23.0843 18.0898 -22.9434 18.0388 -22.8424 17.9374 L -20.3365 15.4316 L -18.8861 19.7856 C -18.8024 20.0372 -18.5307 20.1733 -18.2792 20.0896 C -18.123 20.0377 -18.0042 19.9094 -17.9646 19.7497 L -16.8125 15.1425 L -14.3571 17.5979 C -14.1697 17.7855 -13.8657 17.7856 -13.6782 17.5982 C -13.6746 17.5946 -13.671 17.591 -13.6676 17.5872 L -13.6675 17.5875 Z" fill="#000"/>\n\t<path d="M -16.1217 9.6048 C -16.5451 9.967 -17.177 10.1998 -17.8745 10.2332 L -19.2508 10.2994 C -19.7879 10.3246 -20.55 10.2189 -21.1136 9.9534 C -21.6784 9.6873 -22.01 9.3516 -22.0098 8.7813 C -22.0096 8.1371 -21.9988 7.504 -21.9794 6.8788 L -18.7655 6.8788 C -18.6357 6.8802 -18.511 6.829 -18.4195 6.7369 C -18.2328 6.5486 -18.234 6.2447 -18.4221 6.058 C -18.5133 5.9674 -18.637 5.9173 -18.7656 5.9187 L -21.9342 5.9188 C -21.8203 3.5442 -21.5678 1.2848 -21.172 -0.9291 C -21.1618 -0.9284 -21.1517 -0.9284 -21.1415 -0.9284 L -19.1051 -0.9284 C -18.9753 -0.9269 -18.8505 -0.9781 -18.759 -1.0703 C -18.5724 -1.2585 -18.5736 -1.5625 -18.7618 -1.7492 C -18.853 -1.8396 -18.9766 -1.8897 -19.105 -1.8884 L -20.9878 -1.8883 C -20.7102 -3.2906 -20.3837 -4.6829 -19.9947 -6.0819 C -19.5832 -7.5614 -18.7591 -10.5207 -18.7591 -10.5207 C -18.7297 -10.6276 -18.6374 -10.6968 -18.527 -10.6971 H -18.307 C -18.1888 -10.6971 -18.0934 -10.6197 -18.0711 -10.5034 C -18.0711 -10.5034 -17.5648 -7.9675 -17.1642 -5.9611 L -18.4264 -5.9611 C -18.6915 -5.9658 -18.9102 -5.7548 -18.9149 -5.4897 S -18.7086 -5.0059 -18.4435 -5.0011 C -18.4378 -5.001 -18.4322 -5.001 -18.4264 -5.0011 H -17.0688 C -17.0373 -5.0012 -17.006 -5.0044 -16.9751 -5.0106 C -16.8088 -4.1779 -16.7222 -3.7449 -16.5958 -3.112 C -16.3051 -1.6557 -16.0927 0.2287 -15.9237 2.1847 L -18.4268 2.1846 C -18.6919 2.1799 -18.9106 2.391 -18.9153 2.6561 S -18.709 3.1399 -18.4439 3.1446 C -18.4382 3.1448 -18.4325 3.1448 -18.4268 3.1446 L -15.8521 3.1446 C -15.7169 4.8625 -15.6002 6.6192 -15.5021 8.1324 C -15.4602 8.7772 -15.6955 9.2433 -16.1186 9.6055 L -16.1217 9.6048 Z" fill="#FF6A00"/>\n\t<path d="M -14.5307 16.0663 L -16.7329 13.8641 C -16.9963 13.6008 -17.4461 13.7246 -17.5377 14.0855 L -18.4963 17.9185 L -19.6724 14.3905 C -19.7857 14.053 -20.2144 13.952 -20.4665 14.2036 L -22.5136 16.2506 C -22.4034 15.5786 -22.2434 14.8026 -22.0641 14.3957 C -21.6483 13.4515 -21.4939 13.1944 -20.2995 11.9999 L -19.5479 11.2482 C -18.8589 11.2623 -18.0949 11.1913 -17.4239 11.1369 C -17.2503 11.3105 -17.0742 11.4865 -16.8999 11.6608 C -15.6929 12.8676 -15.2253 13.3354 -14.8025 14.3815 C -14.6634 14.7278 -14.569 15.4528 -14.5307 16.0666 L -14.5308 16.0663 Z" fill="#0F0"/>\n</svg>';let S=C,A=!0;const j=[[{lat:43.523333,lng:-10.086667},{lat:43.35,lng:-9.606667},{lat:43.175,lng:-9.733333},{lat:42.88,lng:-9.733333},{lat:42.88,lng:-10.230833},{lat:43.315833,lng:-10.230833}],[{lat:38.866667,lng:-9.685},{lat:38.661667,lng:-9.666667},{lat:38.565,lng:-10.195},{lat:38.681667,lng:-10.23},{lat:38.866667,lng:-10.23}],[{lat:37.041667,lng:-9.195},{lat:36.945,lng:-9.171667},{lat:36.858333,lng:-9.071667},{lat:36.835,lng:-8.953333},{lat:36.42,lng:-9.1},{lat:36.474333,lng:-9.36},{lat:36.736667,lng:-9.664583},{lat:36.943333,lng:-9.721667}],[{lat:28.33,lng:-14.795},{lat:27.813,lng:-15.005833},{lat:27.858333,lng:-15.1475},{lat:28.341667,lng:-14.951667}],[{lat:28.563333,lng:-15.655},{lat:27.973333,lng:-16.215833},{lat:28.0575,lng:-16.3275},{lat:28.635,lng:-15.78}],[{lat:21.516667,lng:-16.416667},{lat:16,lng:-16.416667},{lat:16,lng:-17.583333},{lat:21.516667,lng:-17.583333}],[{lat:-21.5,lng:-39.75},{lat:-21.933333,lng:-39.233333},{lat:-23,lng:-40.220833},{lat:-23.5775,lng:-41.015},{lat:-23.483333,lng:-41.633333},{lat:-22.133333,lng:-40.416667}],[{lat:-24.9,lng:-42.85},{lat:-25.5,lng:-42.263333},{lat:-25.916667,lng:-43.333333},{lat:-25.505833,lng:-43.75}],[{lat:40.9,lng:-28.566667},{lat:37.81,lng:-23.833333},{lat:36.626667,lng:-24.216667},{lat:36.34,lng:-25.593333},{lat:37.583333,lng:-31.856667},{lat:40,lng:-31.833333}],[{lat:17.75,lng:-25.35},{lat:17.7,lng:-22.666667},{lat:15.966667,lng:-22.133333},{lat:14.533333,lng:-22.833333},{lat:14.666667,lng:-25.416667},{lat:16.166667,lng:-26.133333}],[{lat:49.7675,lng:-6.275833},{lat:49.592333,lng:-6.273333},{lat:49.5925,lng:-6.568333},{lat:49.767167,lng:-6.4925}],[{lat:49.034167,lng:-5.611667},{lat:48.81,lng:-5.416667},{lat:48.62,lng:-5.1975},{lat:48.489167,lng:-5.3675},{lat:48.583333,lng:-5.708333},{lat:48.708333,lng:-6.051667},{lat:48.94,lng:-5.86}],[{lat:46.952167,lng:-2.526667},{lat:46.848583,lng:-2.404333},{lat:46.800417,lng:-2.491083},{lat:46.884583,lng:-2.590583},{lat:46.916083,lng:-2.59175}],[{lat:-44,lng:0},{lat:-44.25,lng:5},{lat:-44.8333,lng:10},{lat:-45.4167,lng:15},{lat:-46,lng:20},{lat:-46.75,lng:25},{lat:-47.5,lng:30},{lat:-47.75,lng:35},{lat:-48,lng:40},{lat:-48.75,lng:45},{lat:-49.3333,lng:50},{lat:-49.8333,lng:55},{lat:-50.25,lng:60},{lat:-50.5833,lng:65},{lat:-50.9167,lng:70},{lat:-50.9167,lng:75},{lat:-50.6667,lng:80},{lat:-50.4167,lng:85},{lat:-50,lng:90},{lat:-49,lng:95},{lat:-46,lng:100},{lat:-46,lng:105},{lat:-46,lng:110},{lat:-46,lng:115},{lat:-49,lng:120},{lat:-49.75,lng:125},{lat:-50,lng:130},{lat:-50,lng:135},{lat:-50,lng:140},{lat:-50,lng:145},{lat:-50,lng:150},{lat:-56.0833,lng:155},{lat:-56.3333,lng:160},{lat:-56.5,lng:165},{lat:-56.6667,lng:170},{lat:-57.3333,lng:175},{lat:-58,lng:180},{lat:-80,lng:180},{lat:-80,lng:-175},{lat:-58.25,lng:-175},{lat:-58.25,lng:-170},{lat:-58,lng:-165},{lat:-57.25,lng:-160},{lat:-56.5,lng:-155},{lat:-55.75,lng:-150},{lat:-55,lng:-145},{lat:-54.25,lng:-140},{lat:-54,lng:-135},{lat:-54.25,lng:-130},{lat:-54.75,lng:-125},{lat:-55.25,lng:-120},{lat:-55.75,lng:-115},{lat:-57.5,lng:-110},{lat:-58.25,lng:-105},{lat:-58.8333,lng:-100},{lat:-59.1667,lng:-95},{lat:-59.5,lng:-90},{lat:-59.6667,lng:-85},{lat:-59.5,lng:-80},{lat:-59.25,lng:-75},{lat:-58.75,lng:-70},{lat:-58,lng:-65},{lat:-56.5,lng:-60},{lat:-54,lng:-55},{lat:-45,lng:-50},{lat:-44,lng:-45},{lat:-44,lng:-40},{lat:-44,lng:-35},{lat:-43.5,lng:-30},{lat:-43,lng:-25},{lat:-43,lng:-20},{lat:-43,lng:-15},{lat:-43,lng:-10},{lat:-43.5,lng:-5}]];function F(){if(void 0===n)return void console.error("Windy store is not available.");let t=n.get("timestamp");n.get("product"),n.on("timestamp",(e=>{const n=new Date(e);e!==t&&(t=e,_(n),E())})),n.on("product",(t=>{E()})),console.log("Plugin initialized and listening for timestamp changes.")}function k(t){return new Promise(((e,n)=>{const l=new FileReader;l.onload=t=>{const n=t.target.result.split("\n").map((t=>t.trim())).filter((t=>t.length>0)),l=n[0].split(";"),o=n.slice(1).map((t=>{const e=t.split(";");return l.reduce(((t,n,l)=>(t[n]=e[l],t)),{})}));w=function(t){return t.includes("Date")&&t.includes("Latitude")&&t.includes("Longitude")?"Avalon":t.includes("position")&&t.includes("time")&&t.includes("sog")?"Dorado":"Unknown"}(l),e(o)},l.onerror=t=>n(t),l.readAsText(t)}))}function O(t){var e=[];if("Avalon"==w){let n=(new Date).getFullYear(),l=null;e=t.map((t=>{const e=t.Date;let o=rt(e,n);return l&&o<l&&(n++,o=rt(e,n)),l=o,{time:o,lat:parseFloat(t.Latitude),lon:parseFloat(t.Longitude),COG:parseFloat(t.Heading),SOG:parseFloat(t.Speed),SAIL:t.SailSet,TWA:parseFloat(t.TWA),TWD:parseFloat(t.TWD),TWS:parseFloat(t.TWS)}}))}else"Dorado"==w&&(e=t.map((t=>{const[e,n]=t.position.split("  ").map((t=>function(t){const e=t.match(/(\d+)[^\d]+([\d.]+)\s*([NSEW])/i);if(!e)throw new Error(`CoordonnÃ©e invalide : ${t}`);const n=parseFloat(e[1]),l=parseFloat(e[2]),o=e[3].toUpperCase();let a=n+l/60;return"S"!==o&&"W"!==o||(a=-a),a}(t.trim())));return{lat:e,lon:n,time:new Date(t.time),SOG:parseFloat(t.sog),TWS:parseFloat(t.TWS),TWD:parseFloat(t.TWD),SOG:parseFloat(t["current speed"]),COG:parseFloat(t["current dir."])}})));for(let t=0;t<e.length-1;t++){var n=e[t];if(0==n.COG){var l=e[t+1],o=it(n.lat,n.lon,l.lat,l.lon);e[t].COG=o}}return e[e.length-1].COG=e[e.length-2].COG,e}function G(t){const e=(new DOMParser).parseFromString(t,"application/xml"),n=e.querySelectorAll("wpt"),l=e.querySelectorAll("rtept");if(0==n.length){const t=[];l.forEach((e=>{const n=parseFloat(e.getAttribute("lat")),l=parseFloat(e.getAttribute("lon"))>0?parseFloat(e.getAttribute("lon"))%360-360:parseFloat(e.getAttribute("lon")),o=e.querySelector("time")?.textContent||null,a=o?new Date(o):null,r=e.querySelector("name")?.textContent||"Unknown";t.push({lat:n,lon:l,time:a,name:r})}));for(let e=0;e<t.length-1;e++){var o=t[e],a=t[e+1],r=it(o.lat,o.lon,a.lat,a.lon);t[e].COG=r}return t[t.length-1].COG=t[t.length-2].COG,t}{const t=e.querySelector("desc")?.textContent;if(!t)return{error:"No desc tag found"};const l=function(t){const e=/COG = ([\d,.]+).+ SOG = ([\d,.]+)nds TWS = ([\d,.]+)nds TWA = ([\d.,]+).+ SAIL = ([\w-]*)/,n=/HDG:(\d+)\s+TWA:([-\d.,]+)\s+(.+?)\s+SOG:([\d.,]+)\s+kt\s+TWS:([\d.,]+)\s+kt/;return e.test(t)?(v=e,1):n.test(t)?(v=n,2):(console.error("format de fichier incompatible"),0)}(t),o=[];return n.forEach((t=>{const e=parseFloat(t.getAttribute("lat")),n=parseFloat(t.getAttribute("lon"))>0?parseFloat(t.getAttribute("lon"))%360-360:parseFloat(t.getAttribute("lon")),a=parseFloat(t.querySelector("ele")?.textContent||"0"),r=t.querySelector("time")?.textContent||null,s=r?new Date(r):null,i=t.querySelector("name")?.textContent||"Unknown",c=(t.querySelector("desc")?.textContent||"").match(v);1==l?o.push({lat:e,lon:n,ele:a,time:s,name:i,COG:c?parseFloat(c[1].replace(",",".")):null,SOG:c?parseFloat(c[2].replace(",",".")):null,TWS:c?parseFloat(c[3].replace(",",".")):null,TWA:c?parseFloat(c[4].replace(",",".")):null,SAIL:c?c[5]:null}):2==l&&null!=c&&o.push({lat:e,lon:n,ele:a,time:s,name:i,COG:c[1],SOG:c[4],TWS:c[5],TWA:c[2],SAIL:c[3]})})),o}}function _(t){var e=0;i(1,d=function(t){var e=[];return c.forEach((n=>{var l=n.waypoints[0];let o=Math.abs(t-l.time);n.waypoints.forEach((e=>{const n=Math.abs(t-e.time);n<o&&(o=n,l=e)})),e.push(l)})),e}(t)),g.forEach((t=>{d&&(t.setLatLng([d[e].lat,d[e].lon]),t.setIcon(L.divIcon({className:"marker-icon",html:`<div style="transform: rotate(${d[e].COG}deg);">${S}</div>`,iconSize:[24,24],iconAnchor:[12,12]})),e++)}))}async function E(){i(2,f=!0);const t=r.once("redrawFinished",(async()=>{i(4,m=[]);for(const t of d){const[e,r]=[t.lat,t.lon];try{const s=await o();if(!s){console.error("No interpolator available for this overlay");continue}if("wind"!==n.get("overlay")){console.error("Please select the wind overlay to interpolate wind values.");continue}const i=s({lat:e,lon:r});if(Array.isArray(i)){const{dir:e,wind:n}=l(i),o=a.wind.convertValue(n," "),r=e,s=st(e,t.COG);m.push({windSpeed:o,windDir:r,TWA:s})}else console.error("Invalid wind data:",i)}catch(t){console.error("Error processing waypoint:",t)}}i(2,f=!1),r.off(t)}))}function D(){h.forEach((t=>{e.removeLayer(t)})),g.forEach((t=>{e.removeLayer(t)})),u.forEach((t=>{e.removeLayer(t)})),i(3,p=!1),i(0,c=[]),i(1,d=[]),h=[],g=[],i(2,f=!1),new Date(n.get("timestamp")).toLocaleString(),i(3,p=!1),i(4,m=[]),i(5,b=[]),x=[],u=[]}var N;return N=()=>{},T().$$.on_mount.push(N),function(t){T().$$.on_destroy.push(t)}((()=>{D()})),"undefined"!=typeof W&&void 0!==n?F():(alert("pas init"),document.addEventListener("windyLoaded",F)),[c,d,f,p,m,b,async function(t){const l=Array.from(t.target.files);i(3,p=!0),l.length;for(const t of l)try{const e=t.name.split(".").pop().toLowerCase();var o=[];if("csv"===e){const e=await k(t);o=await O(e)}else if("gpx"===e){o=G(await at(t))}else console.error("Unsupported file type:",t.name),alert("Type de fichier non pris en charge. Veuillez charger un fichier .csv ou .gpx.");i(0,c=[...c,{fileName:t.name,waypoints:o}])}catch(t){console.error("Error reading file:",t)}!function(){let t=0;c.forEach((l=>{const o=l.waypoints,a=o.map((t=>[t.lat,t.lon]));t=(t+60)%360;const r=`hsl(${t}, 100%, 45%)`;b.push(r);const s=L.polyline(a,{color:r,weight:2,opacity:.5}).addTo(e);h.push(s),o.forEach((t=>{const l=t.time.getTime(),o=new L.marker([t.lat,parseFloat(t.lon)>0?parseFloat(t.lon)%360-360:parseFloat(t.lon)],{icon:L.divIcon({className:"marker-icon",html:`<div><svg width="4" height="4" version="1.1" xmlns="http://www.w3.org/2000/svg"><circle cx="2" cy="2" r="2" fill="${r}" stroke-width="0"/></svg></div>`,iconSize:[4,4],iconAnchor:[2,12],opacity:1})});o.on("click",(()=>n.set("timestamp",l))),o.addTo(e),u.push(o)}));const i=o[0];d.push(i);const c=new L.marker([i.lat,parseFloat(i.lon)>0?parseFloat(i.lon)%360-360:parseFloat(i.lon)],{icon:L.divIcon({className:"marker-icon",html:`<div style="transform: rotate(${i.COG}deg);">${S}</div>`,iconSize:[24,24],iconAnchor:[12,12]})});c.on("click",(()=>function(){A?(S=$,A=!1):(S=C,A=!0);_(n.get("timestamp"))}())),c.addTo(e),g.push(c),e.fitBounds(s.getBounds()),E()}))}(),_(new Date(n.get("timestamp")))},D,function(){y?(x.forEach((t=>{e.removeLayer(t)})),y=!1):(Object.entries(j).forEach((([t,n])=>{var l=L.polygon(n,{color:"red"}).addTo(e);x.push(l)})),y=!0)}]}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");class ut extends U{constructor(t){super(),z(this,t,ct,ot,g,{},B,[-1,-1])}}export{t as __pluginConfig,ut as default};
